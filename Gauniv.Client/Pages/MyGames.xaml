<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Gauniv.Client.Pages.MyGames"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:Gauniv.Client.ViewModel"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Title="MyGames" >

    <!-- Déclenche LoadUserGamesCommand à l'apparition -->
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding LoadUserGamesCommand}" />
    </ContentPage.Behaviors>

    <ContentPage.BindingContext>
        <vm:MyGamesViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="15">
            <!-- Zone de filtres -->
            <Frame CornerRadius="5" Padding="10" BackgroundColor="#EFEFEF">
                <VerticalStackLayout Spacing="10">
                    <!-- Filtre: Nom -->
                    <HorizontalStackLayout Spacing="5">
                        <Label Text="Nom :" WidthRequest="80" VerticalTextAlignment="Center" />
                        <Entry Text="{Binding SearchName}" Placeholder="Ex: Mario" HorizontalOptions="FillAndExpand" />
                    </HorizontalStackLayout>
                    <!-- Filtre: Catégorie -->
                    <HorizontalStackLayout Spacing="5">
                        <Label Text="Catégorie :" WidthRequest="80" VerticalTextAlignment="Center" />
                        <Picker ItemsSource="{Binding CategoriesList}"
                                SelectedItem="{Binding SelectedCategory}"
                                Title="Toutes" HorizontalOptions="FillAndExpand" />
                    </HorizontalStackLayout>
                    <!-- Filtre: MinPrice / MaxPrice -->
                    <HorizontalStackLayout Spacing="5">
                        <Label Text="Min Price :" WidthRequest="80" VerticalTextAlignment="Center" />
                        <Entry Text="{Binding MinPrice}" Keyboard="Numeric" WidthRequest="60" />
                        <Label Text="Max Price :" WidthRequest="80" VerticalTextAlignment="Center" />
                        <Entry Text="{Binding MaxPrice}" Keyboard="Numeric" WidthRequest="60" />
                    </HorizontalStackLayout>
                    <!-- Bouton Appliquer -->
                    <Button Text="Appliquer les filtres" BackgroundColor="#CCC" Command="{Binding ApplyFiltersCommand}" />
                </VerticalStackLayout>
            </Frame>

            <Label Text="Liste de mes jeux" FontSize="Header" FontAttributes="Bold" HorizontalTextAlignment="Center" TextColor="White" />

            <CollectionView ItemsSource="{Binding FilteredUserGames}" Margin="0,0,0,10">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" VerticalItemSpacing="10" HorizontalItemSpacing="10" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="5" Padding="10" HasShadow="True" Margin="5">
                            <VerticalStackLayout Spacing="5">
                                <Label Text="{Binding Id, StringFormat='#{0}'}" FontSize="Small" TextColor="Gray" HorizontalOptions="Center" />
                                <Label Text="{Binding Name}" FontSize="Medium" FontAttributes="Bold" TextColor="Black" HorizontalOptions="Center" />
                                <BoxView HeightRequest="1" Color="LightGray" HorizontalOptions="Fill" />
                                <Label Text="{Binding Description}" FontSize="Micro" FontAttributes="Italic" TextColor="Gray" />
                                <Label Text="{Binding CategoriesString}" FontSize="Micro" TextColor="DarkGray" />
                                <Label Text="{Binding Price, StringFormat='Price : {0} $'}" FontSize="Medium" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Button Text="Charger plus" HorizontalOptions="Center" BackgroundColor="#137EAF" TextColor="White"
                    Command="{Binding LoadMoreUserGamesCommand}" IsVisible="{Binding IsMoreDataAvailable}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
